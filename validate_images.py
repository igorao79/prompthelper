#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: python validate_images.py [–ø—É—Ç—å_–∫_media] [—Ç–µ–º–∞—Ç–∏–∫–∞]
"""

import sys
import os
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
sys.path.append(str(Path(__file__).parent))

from validators.image_validator import validate_images

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–∞"""
    
    # –ü–æ–ª—É—á–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
    if len(sys.argv) > 1:
        media_dir = sys.argv[1]
    else:
        media_dir = "media"  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
    
    if len(sys.argv) > 2:
        theme = sys.argv[2]
    else:
        theme = None
    
    print("üîç –í–ê–õ–ò–î–ê–¢–û–† –ö–ê–ß–ï–°–¢–í–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô")
    print("="*50)
    print(f"üìÅ –ü–∞–ø–∫–∞: {media_dir}")
    print(f"üéØ –¢–µ–º–∞—Ç–∏–∫–∞: {theme or '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}")
    print("="*50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏
    if not os.path.exists(media_dir):
        print(f"‚ùå –û—à–∏–±–∫–∞: –ü–∞–ø–∫–∞ {media_dir} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!")
        print("üí° –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É media —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏–ª–∏ —É–∫–∞–∂–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å")
        return 1
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    media_path = Path(media_dir)
    image_files = list(media_path.glob("*.jpg")) + list(media_path.glob("*.png"))
    
    if not image_files:
        print(f"‚ùå –í –ø–∞–ø–∫–µ {media_dir} –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (jpg/png)")
        return 1
    
    print(f"üìä –ù–∞–π–¥–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: {len(image_files)}")
    print()
    
    try:
        # –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é
        report = validate_images(media_dir, theme, save_report=True, silent_mode=False)
        
        if report.get("error"):
            print(f"‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: {report['error']}")
            return 1
        
        # –í—ã–≤–æ–¥–∏–º –∫—Ä–∞—Ç–∫—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        print("\nüéØ –ö–†–ê–¢–ö–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:")
        print(f"‚≠ê –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: {report['overall_score']}/10")
        
        if report['overall_score'] >= 8:
            print("‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞! –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.")
            return_code = 0
        elif report['overall_score'] >= 6:
            print("‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏–µ–º–ª–µ–º–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞.")
            return_code = 0
        elif report['overall_score'] >= 4:
            print("‚ö†Ô∏è –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞—á–µ—Å—Ç–≤–æ–º. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏–µ.")
            return_code = 1
        else:
            print("‚ùå –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ! –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è.")
            return_code = 2
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã
        problem_files = []
        for filename, analysis in report["quality_scores"].items():
            if analysis.get("overall_score", 0) < 6:
                problem_files.append(filename)
        
        if problem_files:
            print(f"\n‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã: {', '.join(problem_files)}")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        if report["recommendations"]:
            print(f"\nüí° –ì–õ–ê–í–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:")
            for i, rec in enumerate(report["recommendations"][:3], 1):
                print(f"  {i}. {rec}")
        
        print(f"\nüíæ –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: validation_report.json")
        
        return return_code
        
    except KeyboardInterrupt:
        print("\n‚èπÔ∏è –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        return 1
    except Exception as e:
        print(f"\n‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
        return 1

def show_help():
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é"""
    print("""
üîç –í–ê–õ–ò–î–ê–¢–û–† –ö–ê–ß–ï–°–¢–í–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å.

–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
    python validate_images.py                    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–ø–∫—É media
    python validate_images.py media_folder       # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–∞–ø–∫—É  
    python validate_images.py media_folder —Ç–µ–º–∞  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–µ–º—ã

–ü–†–ò–ú–ï–†–´:
    python validate_images.py
    python validate_images.py media "–∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å"
    python validate_images.py ../images "—Å–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã"

–ß–¢–û –ü–†–û–í–ï–†–Ø–ï–¢–°–Ø:
    ‚úì –ß–µ—Ç–∫–æ—Å—Ç—å –∏ —Ä–µ–∑–∫–æ—Å—Ç—å
    ‚úì –ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å
    ‚úì –£—Ä–æ–≤–µ–Ω—å —à—É–º–∞
    ‚úì –¶–≤–µ—Ç–æ–≤–æ–π –±–∞–ª–∞–Ω—Å  
    ‚úì –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤
    ‚úì –ù–∞–ª–∏—á–∏–µ –ª–∏—Ü (–¥–ª—è review –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
    ‚úì –ê–Ω–∞—Ç–æ–º–∏—á–µ—Å–∫–∞—è –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–Ω–æ—Å—Ç—å
    ‚úì –õ–æ–≥–∏—á–Ω–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–æ–≤ (–∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –∏ —Ç.–¥.)
    ‚úì –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    ‚úì –ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

–ö–û–î–´ –í–û–ó–í–†–ê–¢–ê:
    0 - –ö–∞—á–µ—Å—Ç–≤–æ —Ö–æ—Ä–æ—à–µ–µ –∏–ª–∏ –æ—Ç–ª–∏—á–Ω–æ–µ
    1 - –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã, –Ω–æ –ø—Ä–∏–µ–º–ª–µ–º–æ
    2 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–¥–µ–ª–∫–∏

–û–¢–ß–ï–¢:
    –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ validation_report.json
    """)

if __name__ == "__main__":
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã
    if len(sys.argv) > 1 and sys.argv[1] in ["-h", "--help", "help"]:
        show_help()
        sys.exit(0)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é
    exit_code = main()
    sys.exit(exit_code) 